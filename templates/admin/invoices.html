{% extends "base_dashboard.html" %}
{% block title %}ğŸ§¾ Rechnungen | Ouhud CRM{% endblock %}

{% block content %}
<div class="invoice-container">
  <!-- Kopfbereich -->
  <div class="header">
    <div>
      <h1>ğŸ§¾ Rechnungen</h1>
      <p>Verwalte alle Rechnungen zentral an einem Ort.</p>
    </div>
    <a href="/dashboard/invoices/create" class="btn-primary">â• Neue Rechnung</a>
  </div>

  <!-- Filter & Suche -->
  <form method="get" action="/dashboard/invoices" class="filter-form">
    <input type="text" name="q" placeholder="ğŸ” Kunde oder Nummer suchen...">
    <select name="due">
      <option value="">ğŸ“… Alle FÃ¤lligkeiten</option>
      <option value="overdue">â° ÃœberfÃ¤llig</option>
      <option value="upcoming">ğŸŸ¡ DemnÃ¤chst fÃ¤llig</option>
    </select>
    <select name="status">
      <option value="">ğŸ“ Alle Status</option>
      <option value="draft">ğŸ“ Entwurf</option>
      <option value="sent">ğŸ“¤ Gesendet</option>
      <option value="paid">âœ… Bezahlt</option>
      <option value="cancelled">ğŸš« Storniert</option>
      <option value="overdue">â° ÃœberfÃ¤llig</option>
    </select>
    <button type="submit" class="btn-filter">Filtern</button>
  </form>

  <!-- Tabellenbereich -->
  {% if invoices|length == 0 %}
    <div class="empty">ğŸ“­ Keine Rechnungen vorhanden.</div>
  {% else %}
    <div class="table-wrapper">
      <table class="invoice-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Rechnungsnummer</th>
            <th>Kunde</th>
            <th class="right">Betrag</th>
            <th>FÃ¤llig am</th>
            <th>Status</th>
            <th>Aktionen</th>
          </tr>
        </thead>
        <tbody>
          {% for inv in invoices %}
          <tr>
            <td>{{ inv.id }}</td>
            <td class="mono">{{ inv.invoice_number }}</td>
            <td>{{ inv.customer.name if inv.customer else "â€”" }}</td>
            <td class="right mono"><strong>{{ "%.2f"|format(inv.total_amount) }}</strong> {{ company_settings.currency_code or "â‚¬" if company_settings else "â‚¬" }}</td>
            <td>{{ inv.due_date.strftime("%d.%m.%Y") if inv.due_date else "â€”" }}</td>
            <td>
              {% set s = inv.status or '' %}
              {% set bg = '#e5e7eb' %}
              {% set fg = '#374151' %}
              {% if s == 'paid' %}{% set bg = '#dcfce7' %}{% set fg = '#065f46' %}{% endif %}
              {% if s == 'sent' %}{% set bg = '#dbeafe' %}{% set fg = '#1e40af' %}{% endif %}
              {% if s == 'cancelled' %}{% set bg = '#fee2e2' %}{% set fg = '#991b1b' %}{% endif %}
              {% if s == 'overdue' %}{% set bg = '#fef3c7' %}{% set fg = '#92400e' %}{% endif %}
              <span class="badge" style="background:{{ bg }};color:{{ fg }};">
                {% if s == 'paid' %}âœ… Bezahlt{% elif s == 'sent' %}ğŸ“¤ Gesendet{% elif s == 'cancelled' %}ğŸš« Storniert{% elif s == 'overdue' %}â° ÃœberfÃ¤llig{% else %}ğŸ“ Entwurf{% endif %}
              </span>
            </td>
            <td class="actions">
              <a href="/dashboard/invoices/pdf/{{ inv.id }}" target="_blank" class="btn small blue">ğŸ“„</a>
              <a href="/dashboard/invoices/edit/{{ inv.id }}" class="btn small indigo">âœï¸</a>
              <a href="/dashboard/invoices/delete/{{ inv.id }}" onclick="return confirm('Rechnung wirklich lÃ¶schen?');" class="btn small red">ğŸ—‘</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>

        <!-- Summenzeile (optional) -->
        <tfoot>
          <tr>
            <td colspan="3" style="text-align:right;font-weight:600;">Gesamtsumme:</td>
            <td class="right mono" style="font-weight:700;">
              {{ "%.2f"|format(invoices|sum(attribute="total_amount")) }} {{ company_settings.currency_code or "â‚¬" if company_settings else "â‚¬" }}
            </td>
            <td colspan="3"></td>
          </tr>
        </tfoot>
      </table>
    </div>
  {% endif %}
</div>

<style>
  .invoice-container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 1.5rem;
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }

  .header h1 {
    font-size: 1.6rem;
    font-weight: 700;
    color: #1f2937;
    margin: 0;
  }

  .header p {
    color: #6b7280;
    margin: 0;
  }

  .btn-primary {
    background: #4f46e5;
    color: #fff;
    padding: .55rem .9rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
  }

  .filter-form {
    display: flex;
    flex-wrap: wrap;
    gap: .6rem;
    margin: 1rem 0;
  }

  .filter-form input, .filter-form select {
    padding: .55rem .7rem;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    background: #fff;
  }

  .btn-filter {
    background: #4f46e5;
    color: white;
    border: none;
    padding: .55rem .9rem;
    border-radius: 8px;
    cursor: pointer;
  }

  .table-wrapper {
    overflow-x: auto;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  .invoice-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
  }

  th, td {
    padding: .7rem .8rem;
    border-bottom: 1px solid #f3f4f6;
  }

  th {
    background: #f9fafb;
    text-align: left;
    font-weight: 600;
  }

  .right { text-align: right; }
  .mono { font-family: monospace; }

  .badge {
    display: inline-block;
    padding: .25rem .55rem;
    border-radius: 999px;
    font-size: .78rem;
    font-weight: 500;
  }

  .actions {
    text-align: center;
    white-space: nowrap;
  }

  .btn.small {
    display: inline-block;
    padding: .35rem .6rem;
    border-radius: 6px;
    color: white;
    text-decoration: none;
    font-size: .85rem;
  }

  .btn.blue { background: #3b82f6; }
  .btn.indigo { background: #6366f1; }
  .btn.red { background: #ef4444; }

  .btn:hover { opacity: 0.9; }

  .empty {
    background: #fff;
    padding: 1.2rem;
    border-radius: 10px;
    text-align: center;
    color: #6b7280;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);
  }

  tfoot td {
    background: #f9fafb;
    border-top: 2px solid #e5e7eb;
  }
</style>
{% endblock %}