{% extends "base_dashboard.html" %}
{% block title %}ğŸ§¾ Neue Rechnung erstellen | Ouhud CRM{% endblock %}

{% block content %}
<div class="invoice-create">

  <!-- ğŸ§­ Kopfbereich -->
  <header class="invoice-header">
    <div>
      <h1>ğŸ§¾ Neue Rechnung erstellen</h1>
      <p>Erfasse eine neue Kundenrechnung mit FÃ¤lligkeitsdatum und Steuersatz.</p>
    </div>
    <a href="/dashboard/invoices" class="back-link">â† ZurÃ¼ck zur Ãœbersicht</a>
  </header>

  <!-- ğŸ§¾ Formular -->
  <form method="post" action="/dashboard/invoices/create" class="invoice-form">

    <div class="grid-2">
      <div>
        <label>ğŸ‘¤ Kunde</label>
        <select name="customer_id" required>
          <option value="">â€“ Bitte wÃ¤hlen â€“</option>
          {% for c in customers %}
            <option value="{{ c.id }}">{{ c.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label># Rechnungsnummer</label>
        <input type="text" name="invoice_number" value="{{ next_number }}" required>
      </div>
    </div>

    <div class="grid-2">
      <div>
        <label>ğŸ“… FÃ¤lligkeitsdatum</label>
        <input type="date" name="due_date" required>
      </div>

      <div>
        <label>ğŸ’° Nettobetrag ({{ company.currency_code or 'EUR' }})</label>
        <input type="number" step="0.01" min="0" name="total_amount" id="total_amount" required>
      </div>
    </div>

    <div class="grid-2">
      <div>
        <label>ğŸ§¾ MwSt.-Satz</label>
        <select name="tax_rate" id="tax_rate" onchange="updateTotal()" required>
          <option value="0">0 % (steuerfrei)</option>
          <option value="7">7 % (ermÃ¤ÃŸigt)</option>
          <option value="19" selected>19 % (Standard)</option>
        </select>
      </div>
      <div>
        <label>ğŸ’µ Gesamtbetrag (inkl. MwSt.)</label>
        <input type="text" id="gross_amount" readonly value="0.00 {{ company.currency_code or 'EUR' }}">
      </div>
    </div>

    <div>
      <label>ğŸ“ Notiz (optional)</label>
      <textarea name="note" rows="3"></textarea>
    </div>

    <div class="actions">
      <a href="/dashboard/invoices" class="btn-secondary">â† Abbrechen</a>
      <button type="submit" class="btn-primary">ğŸ’¾ Rechnung erstellen</button>
    </div>
  </form>
</div>

<!-- ğŸ’… Design -->
<style>
.invoice-create { max-width:900px; margin:auto; font-family:system-ui,sans-serif; color:#1f2937; }
.invoice-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; margin-bottom:1rem; }
.invoice-header h1 { font-size:1.6rem; font-weight:700; margin:0; }
.invoice-header p { color:#6b7280; margin:0; }
.back-link { color:#4f46e5; text-decoration:none; font-weight:500; }
.back-link:hover { text-decoration:underline; }

.invoice-form {
  background:white; border-radius:12px; padding:1.4rem 1.6rem;
  box-shadow:0 4px 12px rgba(0,0,0,.05); display:grid; gap:1rem;
}
.grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
label { font-weight:600; margin-bottom:.25rem; display:block; }
input, select, textarea {
  width:100%; padding:.55rem .7rem; border:1px solid #e5e7eb;
  border-radius:8px; font-size:.95rem; background:white;
}
textarea { resize:vertical; }

.actions { display:flex; justify-content:space-between; align-items:center; margin-top:.5rem; }
.btn-primary {
  background:#4f46e5; color:white; border:none; border-radius:8px;
  padding:.65rem 1.2rem; cursor:pointer; font-weight:600;
}
.btn-primary:hover { background:#4338ca; }
.btn-secondary { color:#555; text-decoration:none; }
.btn-secondary:hover { text-decoration:underline; }
</style>

<!-- ğŸ§® Live Berechnung (Netto â†’ Brutto) -->
<script>
function updateTotal() {
  const net = parseFloat(document.getElementById('total_amount').value) || 0;
  const tax = parseFloat(document.getElementById('tax_rate').value) || 0;
  const gross = net * (1 + tax / 100);
  document.getElementById('gross_amount').value = gross.toFixed(2) + ' {{ company.currency_code or "EUR" }}';
}
document.getElementById('total_amount').addEventListener('input', updateTotal);
document.getElementById('tax_rate').addEventListener('change', updateTotal);
</script>
{% endblock %}