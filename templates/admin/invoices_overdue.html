{% extends "base_dashboard.html" %}
{% block title %}‚è∞ √úberf√§llige Rechnungen | Ouhud CRM{% endblock %}

{% block content %}
<div class="invoice-container">
  <!-- üß≠ Kopfbereich -->
  <div class="header">
    <div>
      <h1>‚è∞ √úberf√§llige Rechnungen</h1>
      <p>Alle Rechnungen, deren F√§lligkeitsdatum √ºberschritten ist.</p>
    </div>
    <a href="/dashboard/invoices" class="back-link">‚Üê Zur√ºck zur √úbersicht</a>
  </div>

  <!-- üìä Tabelle oder leer -->
  {% if invoices|length == 0 %}
    <div class="empty">
      ‚úÖ Keine √ºberf√§lligen Rechnungen üéâ
    </div>
  {% else %}
    <div class="table-wrapper">
      <table class="invoice-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Rechnungsnummer</th>
            <th>Kunde</th>
            <th>F√§llig am</th>
            <th class="right">Betrag</th>
            <th>Status</th>
            <th>Aktionen</th>
          </tr>
        </thead>
        <tbody>
          {% for inv in invoices %}
          <tr>
            <td>{{ inv.id }}</td>
            <td class="mono">{{ inv.invoice_number }}</td>
            <td>{{ inv.customer.name if inv.customer else "‚Äî" }}</td>
            <td class="overdue-date">
              {{ inv.due_date.strftime("%d.%m.%Y") if inv.due_date else "‚Äî" }}
              {% if inv.due_date %}
                <small style="color:#991b1b;">
                  (+{{ ((current_date - inv.due_date).days) if current_date and inv.due_date else '' }} Tage)
                </small>
              {% endif %}
            </td>
            <td class="right mono"><strong>{{ "%.2f"|format(inv.total_amount) }}</strong> {{ company_settings.currency_code or "‚Ç¨" if company_settings else "‚Ç¨" }}</td>
            <td>
              <span class="badge badge-overdue">‚è∞ √úberf√§llig</span>
            </td>
            <td class="actions">
              <a href="/dashboard/invoices/pdf/{{ inv.id }}" target="_blank" class="btn small blue">üìÑ</a>
              <a href="/dashboard/invoices/edit/{{ inv.id }}" class="btn small indigo">‚úèÔ∏è</a>
              <a href="/dashboard/invoices/delete/{{ inv.id }}" onclick="return confirm('Rechnung wirklich l√∂schen?');" class="btn small red">üóë</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <td colspan="4" class="right" style="font-weight:600;">Gesamtsumme √ºberf√§lliger Rechnungen:</td>
            <td class="right mono" style="font-weight:700;">
              {{ "%.2f"|format(invoices|sum(attribute="total_amount")) }} {{ company_settings.currency_code or "‚Ç¨" if company_settings else "‚Ç¨" }}
            </td>
            <td colspan="2"></td>
          </tr>
        </tfoot>
      </table>
    </div>
  {% endif %}
</div>

<style>
.invoice-container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 1.5rem;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}

.header h1 {
  font-size: 1.6rem;
  font-weight: 700;
  color: #1f2937;
  margin: 0;
}

.header p {
  color: #6b7280;
  margin: 0;
}

.back-link {
  color: #4f46e5;
  text-decoration: none;
  font-weight: 500;
}

.back-link:hover {
  text-decoration: underline;
}

.table-wrapper {
  overflow-x: auto;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  margin-top: 1.5rem;
  background: #fff;
}

.invoice-table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: .7rem .8rem;
  border-bottom: 1px solid #f3f4f6;
}

th {
  background: #f9fafb;
  text-align: left;
  font-weight: 600;
}

tr:hover { background: #fff7f7; }

.right { text-align: right; }
.mono { font-family: monospace; }

.badge {
  display: inline-block;
  padding: .25rem .55rem;
  border-radius: 999px;
  font-size: .78rem;
  font-weight: 500;
}

.badge-overdue {
  background: #fee2e2;
  color: #991b1b;
}

.actions {
  text-align: center;
  white-space: nowrap;
}

.btn.small {
  display: inline-block;
  padding: .35rem .6rem;
  border-radius: 6px;
  color: white;
  text-decoration: none;
  font-size: .85rem;
  margin-right: .3rem;
}

.btn.blue { background: #3b82f6; }
.btn.indigo { background: #6366f1; }
.btn.red { background: #ef4444; }

.btn:hover { opacity: 0.9; }

.empty {
  background: #fff;
  padding: 1.2rem;
  border-radius: 10px;
  text-align: center;
  color: #16a34a;
  font-weight: 500;
  box-shadow: 0 2px 6px rgba(0,0,0,0.04);
  margin-top: 1.5rem;
}

tfoot td {
  background: #f9fafb;
  border-top: 2px solid #e5e7eb;
}
</style>
{% endblock %}