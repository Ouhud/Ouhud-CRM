{% extends "base_dashboard.html" %} {% block title %}Dashboard â€“ Ouhud CRM{%
endblock %} {% block content %}

<!-- =========================================================
   GLOBAL CHART.JS IMPROVEMENTS (Perfect Fonts & Axes)
========================================================= -->
<script>
  Chart.defaults.font.family = "'Inter', sans-serif";
  Chart.defaults.font.size = 13;
  Chart.defaults.color = "#1e293b"; // neutrale Textfarbe
  Chart.defaults.plugins.legend.labels.usePointStyle = true;
  Chart.defaults.plugins.legend.labels.pointStyle = "circle";

  Chart.defaults.scale.ticks.maxRotation = 0; // keine gedrehte Schrift
  Chart.defaults.scale.ticks.minRotation = 0;
  Chart.defaults.scale.ticks.font = { size: 12 };

  Chart.defaults.aspectRatio = 2;
</script>

<!-- =========================================================
   HERO
========================================================= -->
<div class="hero-pro">
  <h1><i class="fas fa-chart-line"></i> Dashboard</h1>
  <p>
    Professionelle Einblicke in Finanzen, Leads, VerkÃ¤ufe und Kundenperformance.
  </p>
</div>

<!-- =========================================================
   KPI GRID
========================================================= -->
<div class="kpi-grid-pro">
  <div class="kpi-card-pro">
    <div class="kpi-icon"><i class="fas fa-money-bill-wave"></i></div>
    <h3>Gesamtumsatz</h3>
    <p>{{ stats.total_sum }}</p>
  </div>
  <div class="kpi-card-pro">
    <div class="kpi-icon"><i class="fas fa-users"></i></div>
    <h3>Kunden</h3>
    <p>{{ stats.customers }}</p>
  </div>
  <div class="kpi-card-pro">
    <div class="kpi-icon"><i class="fas fa-file-invoice"></i></div>
    <h3>Rechnungen</h3>
    <p>{{ stats.invoices }}</p>
  </div>
  <div class="kpi-card-pro">
    <div class="kpi-icon"><i class="fas fa-exclamation-triangle"></i></div>
    <h3>ÃœberfÃ¤llig</h3>
    <p>{{ stats.overdue }}</p>
  </div>
</div>

<!-- =========================================================
   14 CHARTS â€” RESPONSIVE GRID
========================================================= -->
<div class="dashboard-grid-pro">
  <!-- ---------- FINANZ ---------- -->
  <div class="chart-card-pro">
    <h2>ğŸ“ˆ Umsatzentwicklung</h2>
    <canvas id="chartRevenue"></canvas>
  </div>

  <div class="chart-card-pro">
    <h2>ğŸ“… Umsatz pro Monat</h2>
    <canvas id="chartMonthly"></canvas>
  </div>

  <div class="chart-card-pro">
    <h2>ğŸ“Š Umsatz Forecast (AI)</h2>
    <canvas id="chartForecast"></canvas>
  </div>

  <div class="chart-card-pro">
    <h2>ğŸ’¶ Umsatz pro Kunde (LTV)</h2>
    <canvas id="chartLTV"></canvas>
  </div>

  <!-- ---------- SALES ---------- -->
  <div class="chart-card-pro">
    <h2>ğŸ§ª Lead Funnel</h2>
    <canvas id="chartFunnel"></canvas>
  </div>

  <div class="chart-card-pro">
    <h2>ğŸš€ Leads nach Status</h2>
    <canvas id="chartLeadStatus"></canvas>
  </div>

  <div class="chart-card-pro">
    <h2>ğŸ“ˆ Pipeline nach Phase</h2>
    <canvas id="chartPipeline"></canvas>
  </div>

  <div class="chart-card-pro">
    <h2>ğŸ† VerkÃ¤ufer Performance</h2>
    <canvas id="chartSalesRep"></canvas>
  </div>

  <!-- ---------- KUNDEN ---------- -->
  <div class="chart-card-pro">
    <h2>ğŸ‘¥ KundenÃ¼bersicht</h2>
    <canvas id="chartCustomers"></canvas>
  </div>

  <div class="chart-card-pro">
    <h2>ğŸ“ Kunden nach Region</h2>
    <canvas id="chartRegion"></canvas>
  </div>

  <!-- ---------- PRODUKTE ---------- -->
  <div class="chart-card-pro">
    <h2>ğŸ“¦ Top-Produkte</h2>
    <canvas id="chartProducts"></canvas>
  </div>

  <div class="chart-card-pro">
    <h2>ğŸ§© Produktkategorien</h2>
    <canvas id="chartProductCategories"></canvas>
  </div>

  <!-- ---------- RECHNUNGEN ---------- -->
  <div class="chart-card-pro">
    <h2>ğŸ§¾ Rechnungen (Aging)</h2>
    <canvas id="chartInvoices"></canvas>
  </div>

  <div class="chart-card-pro">
    <h2>ğŸ’³ Zahlungsstatus</h2>
    <canvas id="chartInvoiceStatus"></canvas>
  </div>
</div>

<!-- =========================================================
   STYLES â€” V12 ULTRA
========================================================= -->
<style>
  :root {
    --ouhud-blue: #0d2a78;
    --ouhud-blue-light: #1e40af;
    --glass-bg: rgba(255, 255, 255, 0.55);
    --glass-border: rgba(255, 255, 255, 0.24);
    --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.12);
    --shadow-kpi: 0 10px 24px rgba(0, 0, 0, 0.08);
  }

  /* HERO */
  .hero-pro {
    background: linear-gradient(
      135deg,
      var(--ouhud-blue),
      var(--ouhud-blue-light)
    );
    padding: 2rem;
    border-radius: 1.2rem;
    color: white;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-soft);
  }

  /* KPI GRID */
  .kpi-grid-pro {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.4rem;
    margin-bottom: 2rem;
  }

  .kpi-card-pro {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    padding: 1.4rem;
    border-radius: 1rem;
    text-align: center;
    backdrop-filter: blur(16px);
    box-shadow: var(--shadow-kpi);
    transition: 0.25s;
  }
  .kpi-card-pro:hover {
    transform: translateY(-4px);
  }

  .kpi-icon {
    font-size: 2rem;
    color: var(--ouhud-blue);
  }

  /* GRID FOR CHARTS */
  .dashboard-grid-pro {
    display: grid;
    gap: 1.6rem;
    grid-template-columns: repeat(3, 1fr);
  }

  @media (max-width: 1250px) {
    .dashboard-grid-pro {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  @media (max-width: 780px) {
    .dashboard-grid-pro {
      grid-template-columns: 1fr;
    }
  }

  /* CHART CARDS */
  .chart-card-pro {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 1rem;
    padding: 1.2rem;
    min-height: 420px;
    box-shadow: var(--shadow-soft);
    display: flex;
    flex-direction: column;
  }
  .chart-card-pro h2 {
    margin-bottom: 0.6rem;
    color: var(--ouhud-blue);
    font-weight: 700;
  }
  .chart-card-pro canvas {
    flex-grow: 1;
    width: 100% !important;
    height: calc(100% - 40px) !important;
  }

  /* =========================================
   KPI CARDS â€” Ouhud Blue Gradient Style
========================================= */
  .kpi-card-pro {
    background: linear-gradient(
      135deg,
      var(--ouhud-blue),
      var(--ouhud-blue-light)
    );
    border: none;
    color: white;
    padding: 1.6rem;
    border-radius: 1.2rem;
    text-align: center;
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.18);
    backdrop-filter: blur(6px);
    transition: 0.25s;
  }

  .kpi-card-pro:hover {
    transform: translateY(-6px);
    box-shadow: 0 16px 32px rgba(0, 0, 0, 0.22);
  }

  /* KPI ICON (weiÃŸ, grÃ¶ÃŸer, modern) */
  .kpi-icon {
    font-size: 2.4rem;
    margin-bottom: 0.6rem;
    color: #ffffff;
  }

  /* Text in KPI Cards */
  .kpi-card-pro h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 0.3rem;
  }

  .kpi-card-pro p {
    font-size: 1.3rem;
    font-weight: 700;
    color: #e2e8f0; /* sehr helles Grau fÃ¼r Werte */
  }
</style>

<!-- =========================================================
   CHART.JS â€” INITIALISATION
========================================================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {

    /* --- Umsatzentwicklung --- */
    new Chart(chartRevenue,{
      type:"line",
      data:{
        labels:{{ chart_data.months|tojson }},
        datasets:[{
          label:"Umsatz",
          data:{{ chart_data.revenues|tojson }},
          borderColor:"#0d6efd",
          backgroundColor:"rgba(13,110,253,0.25)",
          fill:true, tension:.4
        }]
      }
    });

    /* --- Monatsumsatz --- */
    new Chart(chartMonthly,{
      type:"bar",
      data:{
        labels:{{ chart_data.months|tojson }},
        datasets:[{
          label:"Monatsumsatz",
          data:{{ chart_data.revenues|tojson }},
          backgroundColor:"#1e40af"
        }]
      }
    });

    /* --- Forecast --- */
    new Chart(chartForecast,{
      type:"line",
      data:{
        labels:["Heute","+30 Tage","+60 Tage"],
        datasets:[{
          label:"AI Prognose",
          data:[12000,15000,18500],
          borderColor:"#22c55e",
          backgroundColor:"rgba(34,197,94,0.25)",
          fill:true, tension:.4
        }]
      }
    });

    /* --- LTV --- */
    new Chart(chartLTV,{
      type:"bar",
      data:{
        labels:["A","B","C","D","E"],
        datasets:[{
          label:"Lifetime Value (â‚¬)",
          data:[900,1200,500,1800,650],
          backgroundColor:"#0d9488"
        }]
      }
    });

    /* --- Funnel --- */
    new Chart(chartFunnel,{
      type:"bar",
      data:{
        labels:["Leads","Qualifiziert","Angebot","Gewonnen"],
        datasets:[{
          label:"Funnel",
          data:[280,190,110,40],
          backgroundColor:["#003f88","#0056b3","#1f78ff","#84b4ff"]
        }]
      }
    });

    /* --- Lead Status --- */
    new Chart(chartLeadStatus,{
      type:"bar",
      data:{
        labels:Object.keys({{ chart_data.leads|tojson }}),
        datasets:[{
          label:"Leads",
          data:Object.values({{ chart_data.leads|tojson }}),
          backgroundColor:"#0d6efd"
        }]
      }
    });

    /* --- Pipeline --- */
    new Chart(chartPipeline,{
      type:"bar",
      data:{
        labels:["Kontakt","Demo","Angebot","Verhandlung","Abschluss"],
        datasets:[{
          label:"Pipeline â‚¬",
          data:[4000,9000,15000,8000,3000],
          backgroundColor:"#4f46e5"
        }]
      }
    });

    /* --- VerkÃ¤ufer --- */
    new Chart(chartSalesRep,{
      type:"bar",
      data:{
        labels:["Hamza","Lina","Max","Sara"],
        datasets:[{
          label:"Umsatz (â‚¬)",
          data:[18000,14000,22000,9000],
          backgroundColor:"#0ea5e9"
        }]
      }
    });

    /* --- KundenÃ¼bersicht --- */
    new Chart(chartCustomers,{
      type:"doughnut",
      data:{
        labels:["Aktiv","Neu","Inaktiv"],
        datasets:[{
          data:[120,30,12],
          backgroundColor:["#0d6efd","#1f78ff","#84b4ff"]
        }]
      }
    });

    /* --- Regionen --- */
    new Chart(chartRegion,{
      type:"bar",
      data:{
        labels:["DE","AT","CH","NL"],
        datasets:[{
          label:"Kunden",
          data:[80,20,15,10],
          backgroundColor:"#0284c7"
        }]
      }
    });

    /* --- Produkte --- */
    new Chart(chartProducts,{
      type:"bar",
      data:{
        labels:{{ chart_data.products|tojson }},
        datasets:[{
          label:"Umsatz",
          data:{{ chart_data.product_sales|tojson }},
          backgroundColor:"#14b8a6"
        }]
      }
    });

    /* --- Produktkategorien --- */
    new Chart(chartProductCategories,{
      type:"doughnut",
      data:{
        labels:["Software","Service","Add-ons"],
        datasets:[{
          data:[55,30,15],
          backgroundColor:["#0ea5e9","#6366f1","#14b8a6"]
        }]
      }
    });

    /* --- Rechnungen --- */
    new Chart(chartInvoices,{
      type:"bar",
      data:{
        labels:["0â€“30T","31â€“60T","61â€“90T",">90T"],
        datasets:[{
          label:"FÃ¤llige Rechnungen",
          data:[10,6,3,2],
          backgroundColor:"#f59e0b"
        }]
      }
    });

    /* --- Zahlungsstatus --- */
    new Chart(chartInvoiceStatus,{
      type:"doughnut",
      data:{
        labels:["Bezahlt","Offen","Mahnung"],
        datasets:[{
          data:[65,25,10],
          backgroundColor:["#22c55e","#0ea5e9","#ef4444"]
        }]
      }
    });

  });
</script>

{% endblock %}
