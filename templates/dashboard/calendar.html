{% extends "base_dashboard.html" %}
{% block title %}ðŸ“… Kalender & Aufgaben{% endblock %}

{% block content %}
<div class="calendar-container">
  <h1>ðŸ“… Kalender & Aufgaben</h1>
  <p class="subtitle">
    Verwalte Termine, Meetings und Aufgaben. Klicke in den Kalender, um neue EintrÃ¤ge zu erstellen.
  </p>

  <div id="calendar"></div>
</div>

<!-- âœ… FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<style>
  :root {
    --primary: #0D2A78;
    --primary-dark: #1E40AF;
    --success: #10B981;
    --danger: #DC2626;
    --border: #e5e7eb;
    --bg: #f4f6f8;
  }

  .calendar-container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 1rem;
  }

  .calendar-container h1 {
    font-size: 1.7rem;
    font-weight: 800;
    color: var(--primary);
    margin-bottom: 0.3rem;
  }

  .calendar-container .subtitle {
    color: #6b7280;
    margin-bottom: 1rem;
  }

  #calendar {
    background: #fff;
    padding: 1rem;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  /* FullCalendar-Farben */
  .fc-toolbar-title {
    color: var(--primary);
    font-weight: 700;
  }

  .fc-button {
    background: var(--primary);
    border: none;
    border-radius: 6px;
    color: #fff;
    padding: 0.4rem 0.8rem;
    font-weight: 600;
    transition: background 0.25s ease;
  }

  .fc-button:hover {
    background: var(--primary-dark);
  }

  .fc-event {
    background: var(--success);
    border: none;
    border-radius: 4px;
    color: #fff;
    font-weight: 500;
  }

  .fc-daygrid-day:hover {
    background-color: #f9fafb;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const calendarEl = document.getElementById('calendar');

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
    },
    locale: 'de',
    selectable: true,
    editable: true,
    eventSources: [
      {
        url: '/dashboard/calendar/events',
        method: 'GET',
        failure: () => alert('âš ï¸ Fehler beim Laden der Termine')
      }
    ],
    select: async function (info) {
      const title = prompt('ðŸ“Œ Titel fÃ¼r neuen Termin:');
      if (title) {
        const event = { title, start: info.startStr, end: info.endStr };
        const res = await fetch('/dashboard/calendar/events', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(event)
        });
        res.ok ? calendar.refetchEvents() : alert('âŒ Fehler beim Erstellen.');
      }
      calendar.unselect();
    },
    eventDrop: async function (info) {
      const event = {
        id: info.event.id,
        start: info.event.startStr,
        end: info.event.endStr
      };
      await fetch(`/dashboard/calendar/events/${event.id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(event)
      });
    },
    eventClick: function (info) {
      if (confirm(`ðŸ—‘ Termin "${info.event.title}" lÃ¶schen?`)) {
        fetch(`/dashboard/calendar/events/${info.event.id}`, { method: 'DELETE' })
          .then(() => calendar.refetchEvents());
      }
    }
  });

  calendar.render();
});
</script>
{% endblock %}