{% extends "base_dashboard.html" %}
{% block title %}ğŸ”Œ Integrationen{% endblock %}

{% block content %}
<div style="max-width:1000px;margin:0 auto;">
  <h1 style="font-size:1.6rem;font-weight:700;margin-bottom:1rem;">ğŸ”Œ Integrationen</h1>

  <!-- ğŸ” Suche & Filter -->
  <form method="get" action="/dashboard/integrations" style="margin-bottom:1rem;display:flex;gap:.5rem;">
    <input type="text" name="q" placeholder="Integration suchen..." value="{{ q or '' }}"
      style="flex:2;padding:.6rem;border:1px solid #ccc;border-radius:6px;">
    <select name="type" style="flex:1;padding:.6rem;border:1px solid #ccc;border-radius:6px;">
      <option value="">Alle Typen</option>
      <option value="whatsapp" {% if filter_type=='whatsapp' %}selected{% endif %}>WhatsApp</option>
      <option value="stripe" {% if filter_type=='stripe' %}selected{% endif %}>Stripe</option>
      <option value="mailgun" {% if filter_type=='mailgun' %}selected{% endif %}>Mailgun</option>
    </select>
    <button type="submit" style="background:#4f46e5;color:white;padding:.6rem 1rem;border:none;border-radius:6px;">Suchen</button>
  </form>

  <!-- â• Neue Integration -->
  <form method="post" action="/dashboard/integrations/create" style="margin-bottom:1.5rem;display:flex;gap:.5rem;">
    <input type="text" name="name" placeholder="Name" required
      style="flex:1;padding:.6rem;border:1px solid #ccc;border-radius:6px;">
    <select name="type" required style="flex:1;padding:.6rem;border:1px solid #ccc;border-radius:6px;">
      <option value="">Typ auswÃ¤hlenâ€¦</option>
      <option value="whatsapp">WhatsApp</option>
      <option value="stripe">Stripe</option>
      <option value="mailgun">Mailgun</option>
      <option value="custom">Benutzerdefiniert</option>
    </select>
    <input type="text" name="api_key" placeholder="API-Key (optional)"
      style="flex:1;padding:.6rem;border:1px solid #ccc;border-radius:6px;">
    <button type="submit" style="background:#16a34a;color:white;padding:.6rem 1rem;border:none;border-radius:6px;">â• HinzufÃ¼gen</button>
  </form>

  <!-- ğŸ“‹ Tabelle -->
  <table style="width:100%;border-collapse:collapse;background:white;">
    <thead style="background:#f3f4f6;">
      <tr>
        <th style="padding:.5rem;">#</th>
        <th style="text-align:left;padding:.5rem;">Name</th>
        <th style="text-align:left;padding:.5rem;">Typ</th>
        <th style="text-align:left;padding:.5rem;">Aktiv</th>
        <th style="text-align:left;padding:.5rem;">Erstellt am</th>
        <th style="padding:.5rem;">Aktionen</th>
      </tr>
    </thead>
    <tbody>
      {% if integrations %}
        {% for i in integrations %}
        <tr style="border-bottom:1px solid #eee;">
          <td style="padding:.5rem;">{{ i.id }}</td>
          <td style="padding:.5rem;">{{ i.name }}</td>
          <td style="padding:.5rem;">{{ i.type }}</td>
          <td style="padding:.5rem;">{{ 'âœ…' if i.is_active else 'âŒ' }}</td>
          <td style="padding:.5rem;">{{ i.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
          <td style="padding:.5rem;white-space:nowrap;">
            <a href="/dashboard/integrations/edit/{{ i.id }}" 
               style="background:#3b82f6;color:white;padding:.3rem .6rem;border-radius:4px;text-decoration:none;">âœï¸ Bearbeiten</a>
            <form method="post" action="/dashboard/integrations/delete" style="display:inline;">
              <input type="hidden" name="id" value="{{ i.id }}">
              <button type="submit" style="background:#ef4444;color:white;padding:.3rem .6rem;border:none;border-radius:4px;">ğŸ—‘ LÃ¶schen</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="6" style="text-align:center;padding:1rem;">ğŸ“­ Keine Integrationen vorhanden</td></tr>
      {% endif %}
    </tbody>
  </table>

  <!-- ğŸ“„ Pagination -->
  {% if total_pages > 1 %}
    <div style="margin-top:1rem;text-align:center;">
      {% if page > 1 %}
        <a href="?page={{ page - 1 }}&q={{ q }}&type={{ filter_type }}" style="margin-right:.5rem;">â¬…ï¸ ZurÃ¼ck</a>
      {% endif %}
      Seite {{ page }} von {{ total_pages }}
      {% if page < total_pages %}
        <a href="?page={{ page + 1 }}&q={{ q }}&type={{ filter_type }}" style="margin-left:.5rem;">Weiter â¡ï¸</a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}