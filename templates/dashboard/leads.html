{% extends "base_dashboard.html" %}
{% block title %}üöÄ Leads & Opportunities{% endblock %}

{% block content %}
<div class="leads-container">

  <!-- üîπ Kopfbereich -->
  <div class="header-bar">
    <div>
      <h1>üöÄ Leads & Opportunities</h1>
      <p>Erfasse neue Leads, pflege den Status und wandle sie in Kunden um.</p>
    </div>
    <a href="#new-lead" class="btn-primary">‚ûï Neuen Lead anlegen</a>
  </div>

  <!-- ‚úÖ Status-Meldungen -->
  {% if success %}
  <div class="alert success">‚úÖ {{ success }}</div>
  {% endif %}
  {% if error %}
  <div class="alert danger">‚ö†Ô∏è {{ error }}</div>
  {% endif %}

  <!-- üîç Filter -->
  <form method="get" action="/dashboard/leads" class="filter-bar">
    <input name="q" value="{{ request.query_params.get('q','') }}"
           placeholder="üîé Suchen (Name, E-Mail, Firma)‚Ä¶">
    <select name="status">
      <option value="">Alle Status</option>
      {% for s in LeadStatus %}
        <option value="{{ s.value }}" {% if request.query_params.get('status')==s.value %}selected{% endif %}>{{ s.value }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn-primary">Filtern</button>
  </form>

  <!-- üßæ Neuen Lead anlegen -->
  <section id="new-lead" class="lead-form-card">
    <h2>‚ûï Neuen Lead anlegen</h2>
    <form method="post" action="/dashboard/leads/create" class="lead-form">
      <input type="text" name="name" placeholder="Name *" required>
      <input type="email" name="email" placeholder="E-Mail">
      <input type="text" name="phone" placeholder="Telefon">
      <input type="text" name="company" placeholder="Firma">
      <select name="status">
        {% for s in LeadStatus %}
          <option value="{{ s.value }}">{{ s.value }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn-primary">üíæ Lead speichern</button>
    </form>
  </section>

  <!-- üìã Liste -->
  {% if leads|length == 0 %}
  <div class="empty-state">üì≠ Noch keine Leads vorhanden.</div>
  {% else %}
  <div class="table-wrapper">
    <table class="leads-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>E-Mail</th>
          <th>Firma</th>
          <th>Status</th>
          <th class="center">Aktionen</th>
        </tr>
      </thead>
      <tbody>
        {% for lead in leads %}
        <tr>
          <td>{{ lead.id }}</td>
          <td>{{ lead.name }}</td>
          <td>{{ lead.email or '‚Äî' }}</td>
          <td>{{ lead.company or '‚Äî' }}</td>
          <td>
            {% set v = lead.status or '' %}
            {% set badge_class = 'neutral' %}
            {% if 'Neu' in v %}{% set badge_class = 'info' %}{% endif %}
            {% if 'Kontakt' in v %}{% set badge_class = 'warning' %}{% endif %}
            {% if 'Qualifiziert' in v %}{% set badge_class = 'success' %}{% endif %}
            {% if 'Verloren' in v %}{% set badge_class = 'danger' %}{% endif %}
            <span class="badge {{ badge_class }}">{{ lead.status }}</span>
          </td>
          <td class="center">
            <form method="post" action="/dashboard/leads/{{ lead.id }}/convert" style="display:inline;">
              <button type="submit" class="btn-success" title="In Kunden umwandeln">üîÅ Umwandeln</button>
            </form>
            <a href="/dashboard/leads/{{ lead.id }}/edit" class="btn-info">‚úèÔ∏è Bearbeiten</a>
            <form method="post" action="/dashboard/leads/{{ lead.id }}/delete"
                  onsubmit="return confirm('Diesen Lead wirklich l√∂schen?');" style="display:inline;">
              <button type="submit" class="btn-danger">üóë L√∂schen</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>

<style>
  :root {
    --primary: #0D2A78;
    --primary-dark: #1E40AF;
    --success: #10B981;
    --info: #3B82F6;
    --warning: #F59E0B;
    --danger: #DC2626;
    --neutral: #6B7280;
    --border: #e5e7eb;
    --bg: #f4f6f8;
    --text: #1f2937;
  }

  .leads-container { max-width: 1100px; margin: 0 auto; padding: 1rem; }

  h1 { font-size: 1.7rem; color: var(--primary); margin-bottom: 0.3rem; }
  p { color: #6b7280; margin: 0; }

  /* Kopf & Toolbar */
  .header-bar { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
  .btn-primary { background: var(--primary); color: #fff; padding: .6rem 1rem; border-radius: 8px; text-decoration: none; transition: background .25s; }
  .btn-primary:hover { background: var(--primary-dark); }

  .filter-bar { display: flex; gap: .6rem; flex-wrap: wrap; margin: 1rem 0; }
  .filter-bar input, .filter-bar select {
    padding: .6rem .8rem; border: 1px solid var(--border); border-radius: 8px; flex: 1 1 260px;
  }
  .filter-bar button { background: var(--primary); color: white; border: none; border-radius: 8px; padding: .6rem 1rem; cursor: pointer; }

  /* Alerts */
  .alert { padding: .7rem 1rem; border-radius: 10px; margin: 1rem 0; box-shadow: 0 2px 6px rgba(0,0,0,.05); }
  .alert.success { background: #d1fae5; color: #065f46; }
  .alert.danger { background: #fee2e2; color: #991b1b; }

  /* Lead-Formular */
  .lead-form-card { background: #fff; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
  .lead-form-card h2 { font-size: 1.2rem; color: var(--primary); margin-bottom: 1rem; }
  .lead-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: .8rem; }
  .lead-form input, .lead-form select {
    padding: .6rem; border: 1px solid var(--border); border-radius: 8px; font-size: .95rem;
  }
  .lead-form button { grid-column: 1 / -1; margin-top: .4rem; }

  /* Tabelle */
  .table-wrapper { background: #fff; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); overflow-x: auto; }
  table.leads-table { width: 100%; border-collapse: collapse; }
  table.leads-table th, table.leads-table td { padding: .7rem .9rem; border-bottom: 1px solid var(--border); }
  table.leads-table thead { background: #f3f4f6; }
  table.leads-table tbody tr:hover { background: #f9fafb; }
  .center { text-align: center; }

  /* Buttons in Tabelle */
  .btn-success, .btn-info, .btn-danger {
    border: none; border-radius: 8px; padding: .4rem .7rem; color: white; cursor: pointer; text-decoration: none; transition: background .25s;
  }
  .btn-success { background: var(--success); }
  .btn-info { background: var(--info); }
  .btn-danger { background: var(--danger); }
  .btn-success:hover { background: #0e9e6e; }
  .btn-info:hover { background: #2563eb; }
  .btn-danger:hover { background: #b91c1c; }

  /* Badges */
  .badge {
    display: inline-block; padding: .25rem .6rem; border-radius: 999px; font-size: .8rem; font-weight: 600;
  }
  .badge.success { background: #dcfce7; color: #065f46; }
  .badge.info { background: #dbeafe; color: #1e40af; }
  .badge.warning { background: #fef3c7; color: #92400e; }
  .badge.danger { background: #fee2e2; color: #991b1b; }
  .badge.neutral { background: #e5e7eb; color: #374151; }

  .empty-state {
    background: white; padding: 1.2rem; border-radius: 12px; text-align: center;
    color: var(--neutral); box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }
</style>
{% endblock %}