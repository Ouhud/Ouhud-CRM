{% extends "base.html" %}
{% block title %}ğŸ› Bestellungen{% endblock %}

{% block content %}
  <h1 style="font-size:1.5rem;font-weight:700;margin-bottom:1rem;">ğŸ› Bestellungen</h1>
  <p>Hier kannst du Bestellungen einsehen und verwalten.</p>

  <!-- ========================================= -->
  <!-- ğŸ“ Formular: Neue Bestellung anlegen -->
  <!-- ========================================= -->
  <section style="background:white;padding:1rem;border-radius:8px;margin-top:1.5rem;margin-bottom:2rem;box-shadow:0 2px 5px rgba(0,0,0,0.05);">
    <h2 style="margin-top:0;margin-bottom:0.8rem;font-size:1.2rem;">â• Neue Bestellung</h2>

    <form method="post" action="/dashboard/orders/create" style="display:flex;gap:1rem;flex-wrap:wrap;">
      <!-- Kunde auswÃ¤hlen -->
      <div style="flex:1;min-width:180px;">
        <label for="customer_id" style="display:block;font-size:0.9rem;margin-bottom:0.2rem;">ğŸ‘¤ Kunde</label>
        <select id="customer_id" name="customer_id" required style="width:100%;padding:0.4rem;border-radius:6px;border:1px solid #ccc;">
          <option value="">-- Bitte wÃ¤hlen --</option>
          {% for customer in customers %}
            <option value="{{ customer.id }}">{{ customer.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Betrag -->
      <div style="flex:1;min-width:160px;">
        <label for="total_amount" style="display:block;font-size:0.9rem;margin-bottom:0.2rem;">ğŸ’° Betrag (EUR)</label>
        <input type="number" step="0.01" id="total_amount" name="total_amount" required
               style="width:100%;padding:0.4rem;border-radius:6px;border:1px solid #ccc;">
      </div>

      <!-- Status -->
      <div style="flex:1;min-width:160px;">
        <label for="status" style="display:block;font-size:0.9rem;margin-bottom:0.2rem;">ğŸ“Œ Status</label>
        <select id="status" name="status" style="width:100%;padding:0.4rem;border-radius:6px;border:1px solid #ccc;">
          <option value="offen">ğŸ“ Offen</option>
          <option value="bezahlt">âœ… Bezahlt</option>
          <option value="versendet">ğŸ“¦ Versendet</option>
          <option value="storniert">ğŸš« Storniert</option>
        </select>
      </div>

      <!-- Speichern -->
      <div style="align-self:flex-end;">
        <button type="submit" style="background:#4f46e5;color:white;border:none;padding:0.6rem 1.2rem;
                                     border-radius:6px;font-weight:500;cursor:pointer;">
          ğŸ’¾ Bestellung speichern
        </button>
      </div>
    </form>
  </section>


  <!-- ========================================= -->
  <!-- ğŸ“„ Liste aller Bestellungen -->
  <!-- ========================================= -->
  {% if orders and orders|length > 0 %}
    <table style="width:100%;background:white;border-radius:8px;overflow:hidden;border-collapse:collapse;
                  box-shadow:0 2px 6px rgba(0,0,0,0.05);">
      <thead style="background:#f4f6f8;">
        <tr>
          <th style="padding:0.6rem;text-align:left;">#</th>
          <th style="padding:0.6rem;text-align:left;">Kunde</th>
          <th style="padding:0.6rem;text-align:left;">Datum</th>
          <th style="padding:0.6rem;text-align:left;">Betrag</th>
          <th style="padding:0.6rem;text-align:left;">Status</th>
          <th style="padding:0.6rem;text-align:center;">Aktionen</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
          <tr style="border-top:1px solid #eee;">
            <td style="padding:0.6rem;">{{ order.id }}</td>
            <td style="padding:0.6rem;">{{ order.customer.name if order.customer else 'â€”' }}</td>
            <td style="padding:0.6rem;">{{ order.order_date.strftime('%d.%m.%Y %H:%M') }}</td>
            <td style="padding:0.6rem;">{{ "%.2f"|format(order.total_amount) }} EUR</td>
            <td style="padding:0.6rem;">{{ order.status }}</td>
            <td style="padding:0.6rem;text-align:center;">
              <form method="post" action="/dashboard/orders/{{ order.id }}/delete" style="display:inline;">
                <button type="submit" style="background:#ef4444;color:white;border:none;padding:0.3rem 0.6rem;
                                            border-radius:4px;cursor:pointer;">
                  ğŸ—‘ LÃ¶schen
                </button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div style="margin-top:1rem;padding:1rem;background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.05);">
      ğŸ“­ Noch keine Bestellungen vorhanden.
    </div>
  {% endif %}
{% endblock %}