{% extends "base.html" %}
{% block title %}ğŸ§­ Zielgruppen-Segmente{% endblock %}

{% block content %}
<div style="max-width:1100px;margin:0 auto;">
  <h1 style="font-size:1.7rem;font-weight:700;margin-bottom:1rem;">ğŸ§­ Zielgruppen-Segmente</h1>

  <!-- ğŸ” Suche + Filter -->
  <form method="get" action="/dashboard/segments" style="margin-bottom:1rem;display:flex;gap:.5rem;align-items:center;">
    <input type="text" name="q" placeholder="Segment suchen..." value="{{ q or '' }}"
      style="flex:1;padding:.6rem;border:1px solid #ccc;border-radius:6px;">
    <select name="filter" style="padding:.6rem;border:1px solid #ccc;border-radius:6px;">
      <option value="">Alle Kategorien</option>
      <option value="customer" {% if filter == 'customer' %}selected{% endif %}>Kunden</option>
      <option value="lead" {% if filter == 'lead' %}selected{% endif %}>Leads</option>
      <option value="newsletter" {% if filter == 'newsletter' %}selected{% endif %}>Newsletter</option>
    </select>
    <button type="submit" style="background:#4f46e5;color:white;padding:.6rem 1rem;border:none;border-radius:6px;cursor:pointer;">ğŸ” Filtern</button>
  </form>

  <!-- â• Neues Segment -->
  <form method="post" action="/dashboard/segments/create" style="margin-bottom:1.5rem;display:flex;gap:.5rem;">
    <input type="text" name="name" placeholder="Segmentname" required
      style="flex:1;padding:.6rem;border:1px solid #ccc;border-radius:6px;">
    <input type="text" name="description" placeholder="Beschreibung"
      style="flex:2;padding:.6rem;border:1px solid #ccc;border-radius:6px;">
    <button type="submit" style="background:#16a34a;color:white;padding:.6rem 1rem;border:none;border-radius:6px;cursor:pointer;">â• Erstellen</button>
  </form>

  <!-- ğŸ“‹ Segment-Tabelle -->
  <table style="width:100%;border-collapse:collapse;background:white;box-shadow:0 2px 6px rgba(0,0,0,0.05);border-radius:8px;overflow:hidden;">
    <thead style="background:#f3f4f6;">
      <tr>
        <th style="padding:.5rem;">#</th>
        <th style="text-align:left;padding:.5rem;">Name</th>
        <th style="text-align:left;padding:.5rem;">Beschreibung</th>
        <th style="text-align:left;padding:.5rem;">ğŸ“Š Statistik</th>
        <th style="text-align:left;padding:.5rem;">Erstellt am</th>
        <th style="text-align:left;padding:.5rem;">Aktionen</th>
      </tr>
    </thead>
    <tbody>
      {% if segments %}
        {% for s in segments %}
        <tr style="border-bottom:1px solid #eee;">
          <td style="padding:.5rem;">{{ s.id }}</td>
          <td style="padding:.5rem;">{{ s.name }}</td>
          <td style="padding:.5rem;">{{ s.description or '-' }}</td>
          <td style="padding:.5rem;">
            ğŸ‘¥ {{ s.stats_count or 0 }} Kontakte<br>
            ğŸ“ˆ {{ s.stats_rate or 0 }} %
          </td>
          <td style="padding:.5rem;">{{ s.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
          <td style="padding:.5rem;white-space:nowrap;">
            <a href="/dashboard/segments/edit/{{ s.id }}" 
               style="background:#3b82f6;color:white;padding:.3rem .6rem;border-radius:4px;text-decoration:none;">âœï¸ Bearbeiten</a>
            <form method="post" action="/dashboard/segments/delete" style="display:inline;">
              <input type="hidden" name="id" value="{{ s.id }}">
              <button type="submit" 
                      style="background:#ef4444;color:white;padding:.3rem .6rem;border:none;border-radius:4px;cursor:pointer;">ğŸ—‘ LÃ¶schen</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="6" style="text-align:center;padding:1rem;">ğŸ“­ Keine Segmente vorhanden</td></tr>
      {% endif %}
    </tbody>
  </table>

  <!-- ğŸ“„ Pagination -->
  {% if total_pages > 1 %}
    <div style="margin-top:1rem;text-align:center;">
      {% if page > 1 %}
        <a href="?page={{ page - 1 }}&q={{ q }}&filter={{ filter }}" style="margin-right:.5rem;">â¬…ï¸ ZurÃ¼ck</a>
      {% endif %}
      Seite {{ page }} von {{ total_pages }}
      {% if page < total_pages %}
        <a href="?page={{ page + 1 }}&q={{ q }}&filter={{ filter }}" style="margin-left:.5rem;">Weiter â¡ï¸</a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}