{% extends "email/base.html" %} {% set active_tab = "compose" %} {% block
email_content %}

<div class="max-w-3xl mx-auto">
  <!-- TITLE -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">‚úâÔ∏è Neue E-Mail schreiben</h1>
    <p class="text-gray-600">
      Sende eine offizielle Nachricht an deine Kunden.
    </p>
  </div>

  <!-- CARD -->
  <div class="bg-white shadow-md border border-gray-200 rounded-xl p-8">
    <form method="POST" action="/dashboard/email/send" class="space-y-6">
      <!-- RECIPIENT -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Empf√§nger</label
        >

        <input
          type="text"
          id="customerSearch"
          placeholder="üîç Kunden suchen‚Ä¶"
          class="crm-input w-full mb-3"
        />

        <select
          id="customerSelect"
          name="recipients"
          multiple
          class="crm-input w-full h-36 overflow-y-auto"
        >
          {% for c in customers %}
          <option value="{{ c.email }}">{{ c.name }} ‚Äì {{ c.email }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- SUBJECT -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Betreff</label
        >
        <input
          type="text"
          name="subject"
          placeholder="Betreff der Nachricht"
          class="crm-input w-full"
          required
        />
      </div>

      <!-- MESSAGE -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Nachricht</label
        >
        <textarea
          name="body"
          rows="8"
          placeholder="Schreibe hier deine Nachricht..."
          class="crm-input w-full resize-none"
          required
        ></textarea>
      </div>

      <!-- BUTTON -->
      <button class="crm-btn-primary w-full py-3 text-lg">
        ‚úâÔ∏è Offizielle E-Mail senden
      </button>
    </form>
  </div>
</div>

<style>
  /* GLOBAL CRM INPUT FIELD */
  .crm-input {
    padding: 12px 14px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    background: #fafafa;
    font-size: 15px;
    color: #374151;
    outline: none;
    transition: all 0.2s ease;
  }
  .crm-input:focus {
    border-color: #6366f1;
    background: #ffffff;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
  }

  /* CRM BUTTON */
  .crm-btn-primary {
    background: #4f46e5;
    color: white;
    border-radius: 8px;
    font-weight: 600;
    transition: background 0.2s;
  }
  .crm-btn-primary:hover {
    background: #4338ca;
  }
</style>

<script>
  // Live customer search
  const search = document.getElementById("customerSearch");
  const select = document.getElementById("customerSelect");

  search.addEventListener("input", function () {
    const q = this.value.toLowerCase();
    for (const opt of select.options) {
      opt.style.display = opt.text.toLowerCase().includes(q) ? "" : "none";
    }
  });
</script>

{% endblock %}
